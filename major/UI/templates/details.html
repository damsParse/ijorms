{% extends 'base.html' %}

{% block body %}

<h1>{{ job.company }}</h1>
<h3>{{ job.title }}</h3>
<h4>category: {{ job.category }}</h4><br>
<h4>post: {{ job.post }}</h4><br>
<h4>Vacancies: {{ job.no_of_vacancies }}</h4><br>
<h4>Degree Needed: {{ job.degree }}</h4><br>
<h4>Skills Needed: {{ job.skills }}</h4><br>
<h4>Work Experience Needed: {{ job.work_exp }}</h4><br>
<h4>Deadline: {{ job.deadline }}</h4>
{% if applied %}
    <button>You have applied for this job</button>
{% else %}
    <button id="{{ job.id }}" value="{{ user }}" onclick="add_applicant(this.value,this.id)">Apply</button>
{% endif %}

<script>

        function getCookie(c_name){
        if (document.cookie.length > 0){
            c_start = document.cookie.indexOf(c_name + "=");
            if (c_start != -1){
                c_start = c_start + c_name.length + 1;
                c_end = document.cookie.indexOf(";", c_start);
                if (c_end == -1) c_end = document.cookie.length;
                return unescape(document.cookie.substring(c_start,c_end));
            }
        }
        return "";
    }

    $(function () {
        $.ajaxSetup({
            headers: { "X-CSRFToken": getCookie("csrftoken") }
        });
    });

    function add_applicant(user,job) {
        $.ajax({
            url : '/add/',
            type : 'POST',
            dataType : 'json',
            data : { 'csrfmiddlewaretoken' : '{{ csrf_token }}', 'cuser':user, 'job':job},
            success : function(data){
                console.log(typeof data);
                var text = document.getElementById(job);
                console.log(text.innerHTML)
                text.innerHTML = "You have applied for this job";
            },
            error : function(data){
                console.log(data);
            }
        });
    }

</script>

{% endblock %}

